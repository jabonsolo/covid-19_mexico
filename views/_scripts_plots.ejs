<script>
    // Plot to aggregated Chart
    var ctx = document.getElementById('aggregatedChart');
    var myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: <%- JSON.stringify(data.date); %>,
            datasets: [{
                label: 'Confirmados',
                data: <%= JSON.stringify(data.confirmed); %>,
                backgroundColor: [
                    'rgba(87, 146, 223, 0.2)',
                ],
                borderColor: [
                    'rgba(87, 146, 223, 1)',
                ],
                borderWidth: 3
            },
            {
                label: 'Activos',
                data: <%= JSON.stringify(data.active); %>,
                backgroundColor: [
                    'rgba(170, 89, 242, 0.2)',
                ],
                borderColor: [
                    'rgba(170, 89, 242, 1)',
                ],
                borderWidth: 3
            },
            {
                label: 'Recuperados',
                data: <%= JSON.stringify(data.recovered); %>,
                backgroundColor: [
                    'rgba(97, 179, 102, 0.2)',
                ],
                borderColor: [
                    'rgba(97, 179, 102, 1)',
                ],
                borderWidth: 3
            },
            {
                label: 'Muertes',
                data: <%= JSON.stringify(data.deaths); %>,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                ],
                borderWidth: 3
            }
        ]},
        options: {
            plugins: {
                datalabels: {
                    display: false
                }
            },
            responsive: true,
            legend: {
                position: 'top',
            },
            title: {
                display: true,
                text: 'Total de casos COVID-19 en México',
            },
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });

    //Plot to daily chart
    var ctx2 = document.getElementById('dailyChart');
    var myChart = new Chart(ctx2, {
        type: 'line',
        data: {
            labels: <%- JSON.stringify(data.date); %>,
            datasets: [{
                label: 'Confirmados',
                data: <%= JSON.stringify(data.confirmedDiff); %>,
                backgroundColor: [
                    'rgba(87, 146, 223, 0.2)',
                ],
                borderColor: [
                    'rgba(87, 146, 223, 1)',
                ],
                borderWidth: 3
            },
            {
                label: 'Recuperados',
                data: <%= JSON.stringify(data.recoveredDiff); %>,
                backgroundColor: [
                    'rgba(97, 179, 102, 0.2)',
                ],
                borderColor: [
                    'rgba(97, 179, 102, 1)',
                ],
                borderWidth: 3
            },
            {
                label: 'Muertes',
                data: <%= JSON.stringify(data.deathsDiff); %>,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                ],
                borderWidth: 3
            }
        ]},
        options: {
            plugins: {
                datalabels: {
                    display: false
                }
            },
            responsive: true,
            legend: {
                position: 'top',
            },
            title: {
                display: true,
                text: 'Nuevos casos por día COVID-19 en México',
            },
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });

    //Colors used on comparative Charts
    var arrayColors = [
        "rgba(131,175,9)",
        "rgba(142,220,248)",
        "rgba(201,184,206)",
        "rgba(26,170,210)",
        "rgba(220,198,158)",
        "rgba(158,170,84)",
        "rgba(60,144,243)",
        "rgba(131,142,151)",
        "rgba(61,87,125)",
        "rgba(93,152,118)",
        "rgba(252,26,54)"
    ]

    //Plot comparative chart confirmed cases
    var ctx3 = document.getElementById('top10Chart_confirmed');
    var myChart = new Chart(ctx3, {
        type: 'line',
        data: {
            labels: <%- JSON.stringify(top10Data.enumArrayConfirmed); %>,
            datasets: [
                <% for(key in top10Data.top10List) { %>
                {
                    label: "<%- top10Data.top10List[key].country %>",
                    fill: false,
                    data: <%= JSON.stringify(top10Data.top10DataConfirmed[key].confirmed); %>,
                    borderColor: arrayColors[<%- key %>],
                    <% if(key == 10) { %>
                        borderWidth: 3
                    <% } else { %>
                        borderWidth: 1
                    <% } %> 
                },
                <% } %>
            ]
        },
        options: {
            plugins: {
                datalabels: {
                    display: false
                }
            },
            responsive: true,
            legend: {
                position: 'top',
            },
            title: {
                display: true,
                text: 'Numero acumulado de casos confirmados, por numero de días desde el caso numero 100.',
            },
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: false
                    }
                }]
            }
        }
    });

    //Plot comparative chart deaths
    var ctx4 = document.getElementById('top10Chart_deaths');
    var myChart = new Chart(ctx4, {
        type: 'line',
        data: {
            labels: <%- JSON.stringify(top10Data.enumArrayDeaths); %>,
            datasets: [
                <% for(key in top10Data.top10List) { %>
                {
                    label: "<%- top10Data.top10List[key].country %>",
                    data: <%= JSON.stringify(top10Data.top10DataDeaths[key].deaths); %>,
                    fill: false,
                    borderColor: arrayColors[<%- key %>],
                    <% if(key == 10) { %>
                        borderWidth: 3
                    <% } else { %>
                        borderWidth: 1
                    <% } %> 
                },
                <% } %>
            ]
        },
        options: {
            plugins: {
                datalabels: {
                    display: false
                }
            },
            responsive: true,
            legend: {
                position: 'top',
            },
            title: {
                display: true,
                text: 'Numero acumulado de muertes, por numero de días desde la muerte numero 10.',
            },
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: false
                    }
                }]
            }
        }
    });

    //Pie plot
    var pie = new Chart(document.getElementById("pie-chart"), {
        type: 'pie',
        data: {
            labels: ["Activos", "Recuperados", "Muertes"],
            datasets: [{
                label: "Total casos COVID-19",
                backgroundColor: [
                    'rgba(170, 89, 242, 1)',
                    'rgba(97, 179, 102, 1)',
                    'rgba(255, 99, 132, 1)',
                ],
                data: [
                    <%- ((data.active[data.active.length - 1] / data.confirmed[data.confirmed.length - 1]) * 100).toFixed(2) %> ,
                    <%- ((data.recovered[data.recovered.length - 1] / data.confirmed[data.confirmed.length - 1]) * 100).toFixed(2) %>,
                    <%- ((data.deaths[data.deaths.length - 1] / data.confirmed[data.confirmed.length - 1]) * 100).toFixed(2) %>
                ],
            }]
        },
        options: {
            title: {
                display: true,
                text: 'Total de casos confirmados de COVID-19 en porcentaje.'
            },
            plugins: {
                datalabels: {
                    formatter: (value, ctx) => {
                        let datasets = ctx.chart.data.datasets;
                        if (datasets.indexOf(ctx.dataset) === datasets.length - 1) {
                            let sum = datasets[0].data.reduce((a, b) => a + b, 0);
                            let percentage = Math.round((value / sum) * 100) + '%';
                            return percentage;
                        } else {
                            return percentage;
                        }
                    },
                    color: '#fff',
                }
            }
        }
    });

    
//     window.onload=function(){
//         var data = [{
//    data: [50, 55, 60, 33],
//    labels: ["India", "China", "US", "Canada"],
//    backgroundColor: [
//      "#4b77a9",
//      "#5f255f",
//      "#d21243",
//      "#B27200"
//    ],
//    borderColor: "#fff"
//  }];
//  var options = {
//    tooltips: {
//      enabled: false
//    },
//    plugins: {
//      datalabels: {
//        formatter: (value, ctx) => {
//          let datasets = ctx.chart.data.datasets;
//          if (datasets.indexOf(ctx.dataset) === datasets.length - 1) {
//            let sum = datasets[0].data.reduce((a, b) => a + b, 0);
//            let percentage = Math.round((value / sum) * 100) + '%';
//            return percentage;
//          } else {
//            return percentage;
//          }
//        },
//        color: '#fff',
//      }
//    }
//  };
//  var ctx = document.getElementById("pie-chart").getContext('2d');
//  var myChart = new Chart(ctx, {
//    type: 'pie',
//    data: {
//      datasets: data
//    },
//    options: options
//  });
//     }

      

</script>